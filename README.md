# Системный дизайн социальной сети для путешественников по курсу System Design от [balun.cources](https://balun.courses/courses/system_design)

## Функциональные требования
- публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;
- оценка и комментарии постов других путешественников;
- подписка на других путешественников, чтобы следить за их активностью;
- поиск популярных мест для путешествий и просмотр постов с этих мест;
- просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке;
- мобильное приложение;
- веб-версия;

## Нефункциональные требования
- DAU 10 000 000
- Аудитория стран СНГ
- Данные будем хранить всегда
- Активности пользователей
  - в среднем каждый пользователь публикует пост из путешествий 1 раз в неделю
  - в среднем каждый пользователь ставит лайк на посты других путешественников 5 раз в день
  - в среднем каждый пользователь пишет комментарии к постам других путешественников 3 раза в неделю
  - в среднем каждый пользователь осуществляет подписку на других путешественников 2 раза в неделю
  - в среднем каждый пользователь делает поиск популярных мест 2 раза в день
  - в среднем каждый пользователь выполняет просмотр ленты других путешественников 3 раза в день
  - в среднем каждый пользователь выполняет просмотр своей ленты подписок 3 раза в день
- Лимиты
  - у пользователя может быть максимум 1 000 000 подписчиков
  - пользователь может ставить максимум 5 лайков в минуту на посты других путешественников
  - пользователь может опубликовать максимум 5 пост в минуту
  - пользователь может писать комментарии максимум 5 раз в минуту
  - пользователь может осуществлять подписку на других путешественников максимум 1 раз в секунду
  - пользователь может делать поиск популярных мест максимум 1 раз в секунду
  - пользователь может выполнять просмотр ленты других путешественников максимум 1 раз в секунду
  - пользователь может выполнять просмотр своей ленты подписок максимум 5 раз в минуту
- Сезонность
  - летом больше всего путешественников
- Временные ограничения
  - время ответа сервера для обработки запроса пользователя не должно превышать 300 мс
  - время загрузки ленты не должно превышать 2 секунды
  - время загрузки фотографий в посте не должно превышать 5 секунд
  - время публикации поста не должно превышать 10 секунд

- Доступность приложения
  - доступность сервиса должна быть не менее 99.9% 

## Нагрузка

### Подсистема постов
- RPS (write) = 10 000 000 * 1/7 (1 раз за 7 дней) / 100 000 = 100 / 7 = 15
- RPS (read) = 10 000 000 * 6 (своя лента и других) * 20 (постов в ленте) / 100 000 = 100 * 6 * 20 = 12 000

### Подсистема реакций
- RPS (write like) = 10 000 000 * 5 (лайков в день) / 100 000 = 100 * 5 = 500
- RPS (read like) = 10 000 000 * 5 / 100 000 = 500
- RPS (write subscribe) = 10 000 000 * 2/7 (2 подписки в неделю) / 100 000 = 100 * 2 / 7 = 30
- RPS (read subscribe) = 10 000 000 * 2/7 / 100 000 = 30

### Подсистема комментариев
- RPS (write) = 10 000 000 * 3/7 (3 комментария в неделю) / 100 000 = 100 * 3 / 7 = 45
- RPS (read) = 10 000 000 * 120 (постов) * 5 (комментов в каждом посту) / 100 000 = 100 * 600 = 60 000

## Трафик

### Подсистема постов
Post
| поле | размер |
| --- | --- | 
| id |8 |
| created_at |8|
| user_id |8|
| title |50 * 2|
| text |500 * 2|
| |  = 1500B |  



- Traffic (write text) = 15 * 1500 B = 25 000 B/s = 25 KB/s
- Traffic (write image) = 15 * 3 (рисунка на пост) * 500 KB = 25 000 KB/s = 25 MB/s
- Traffic (read text) = 12 000 * 1500 B = 20 000 000 B/s = 20 MB/s
- Traffic (read image) = 12 000 * 3 * 500 KB = 20 GB/s

### Подсистема реакций
Like
| поле | размер |
| --- | --- | 
| id |8|
| created_at |8|
| user_id |8|
| post_id |8|
| amount |8|
||  = 100B |

Subscribe
| поле | размер |
| --- | --- | 
| id |8|
| created_at |8|
| user_id |8|
| subscribed_user_id |8|
|| = 100B|

- Traffic (write) = 530 * 100B = 60 KB/s
- Traffic (read) = 530 * 100B = 60 KB/s

### Подсистема комментариев
Comment
| поле | размер |
| --- | --- | 
| id |8|
| created_at |8|
| user_id |8|
| commented_user_id |8|
| comment |200 * 2|
 || = 500B|

- Traffic (write) = 45 * 500 = 25 000 B/s = 25 KB/s
- Traffic (read) = 60 000 * 500 = 30 000 000 B/s = 30 MB/s

### Общий трафик
- Traffic (write text) = 25 KB/s + 60 KB/s + 25 KB/s = 110 KB/s
- Traffic (write image) = 25 MB/s
- Traffic (read text) = 20 MB/s + 60 KB/s + 30 MB/s = 50 MB/s
- Traffic (read image) = 20 GB/s
